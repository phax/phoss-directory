# Localstack

docker run -d -p 4566:4566 -e SERVICES=s3 -e DEBUG=1 -e PERSISTENCE=1 -v LocalstackVolume:/var/lib/localstack -e LS_LOG=trace --name local-s3 localstack/localstack

Region must be: `us-east-1` for localstack

Configure AWS for localstack
```
aws configure set aws_access_key_id test
aws configure set aws_secret_access_key test
aws configure set region us-east-1
```

Create initial bucket
```shell
aws --endpoint-url=http://localhost:4566 s3 mb s3://pd-export-1
```

Apply a public-read bucket policy (save as policy.json):

```json
{"Version":"2012-10-17",
 "Statement":[
   {"Sid":"PublicReadGetObject",
    "Effect":"Allow",
    "Principal":"*",
    "Action":"s3:GetObject",
    "Resource":"arn:aws:s3:::pd-export-1/*"}
]}
```

```shell
aws --endpoint-url=http://localhost:4566 s3api put-bucket-policy --bucket pd-export-1 --policy file://policy.json
```
​
Enable website hosting:
```shell
aws --endpoint-url=http://localhost:4566 s3 website s3://pd-export-1/ --index-document index.html
```
​
Example upload content (not needed) - local file `index.html`:
```shell
aws --endpoint-url=http://localhost:4566 s3 cp index.html s3://pd-export-1/ --acl public-read
```
​
Access the Site: `http://pd-export-1.s3-website.localhost.localstack.cloud:4566/` in a browser.
​
Verify config:
```shell
aws --endpoint-url=http://localhost:4566 s3api get-bucket-website --bucket pd-export-1
```
